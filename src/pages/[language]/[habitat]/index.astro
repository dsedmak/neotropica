---
import Layout from "../../../layouts/Layout.astro";
import { Image } from 'astro:assets';
import { getCollection } from "astro:content";

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const habitats = await getCollection("habitats");

  return habitats.map((habitat) => {
    const [slug, language] = habitat.id.split("/");
    return {
      params: { language, habitat: slug, slug },
      props: { habitat },
    };
  });
}
// 2. For your template, you can get the entry directly from the prop
const { habitat } = Astro.props;
const inhabitants = await getCollection("inhabitants", ({data: {habitat: {id}}}) => id === habitat.id);
---

<Layout title={habitat.data.name}>
  <a href="./about">
    <article>
      <header><h3 style="margin-block-end: 0;">{habitat.data.name}</h3 ></header>
      <Image src={habitat.data.cover} alt={habitat.data.name} width={650} style="width: 100%" loading="eager" />
    </article>
  </a>
  { inhabitants.map((inhabitant, index) => (
    <a href={`./${inhabitant.id.split("/")[0]}`}>
      <article>
        <header><h3 style="margin-block-end: 0;">{ inhabitant.data.common_name } ({ inhabitant.data.latin_name })</h3></header>
        <Image src={inhabitant.data.cover} alt={inhabitant.data.common_name} width={650} style="width: 100%" loading={index < 1 ? 'eager' : 'lazy'} />
      </article>
    </a>
  ))}
</Layout>
